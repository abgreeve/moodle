define(["jquery","core/url","core/str"],function(a,b,c){var d,e,f={ELEMENTS:".tool_dataprivacy-element",EXPANDALL:".tool_dataprivacy-expand-all",AWESOMEICONS:":header i.fa",OLDICONS:":header img.icon",ACTIVEFILTERS:'.tool_dataprivacy-filter[data-display="hide"]',SEARCHBOX:".tool_dataprivacy-search-box"},g=0,h=0,i=a('<img alt="" src="'+b.imageUrl("t/expanded")+'"/>'),j=a('<img alt="" src="'+b.imageUrl("t/collapsed")+'"/>'),k=function(){var b=a.extend(!0,{},d);if(Object.keys(d).length!=Object.keys(e).length||g>0){for(var c in e)delete b[c];for(var c in b){var f=a('[data-plugintarget="'+c+'"]');f.addClass("hide"),f.attr("aria-expanded",!1),a('[data-plugin="'+c+'"]').addClass("hide")}for(var c in e){a('[data-plugin="'+c+'"]').removeClass("hide");var f=a('[data-plugintarget="'+c+'"]');f.attr("aria-expanded",!0),0==e[c].plugins.length?(f.attr("aria-expanded",!1),f.addClass("hide"),f.children().each(function(){a(this).removeClass("hide")})):(f.removeClass("hide"),f.children().each(function(){a(this).addClass("hide")})),e[c].plugins.forEach(function(b){a('[data-id="'+b.raw_component+'"]').removeClass("hide")})}}else l()},l=function(){for(var b in d){var c=a('[data-plugintarget="'+b+'"]');c.addClass("hide"),c.attr("aria-expanded",!1),a('[data-plugin="'+b+'"]').removeClass("hide")}},m=function(a,b){a.addClass("hide"),a.attr("aria-expanded",!1),b.find(f.AWESOMEICONS).removeClass("fa-minus-square"),b.find(f.AWESOMEICONS).addClass("fa-plus-square"),b.find(f.OLDICONS).attr("src",j.attr("src"))},n=function(a,b){a.removeClass("hide"),a.attr("aria-expanded",!0),b.find(f.AWESOMEICONS).removeClass("fa-plus-square"),b.find(f.AWESOMEICONS).addClass("fa-minus-square"),b.find(f.OLDICONS).attr("src",i.attr("src"))};return{init:function(b){d=b,e=a.extend(!0,{},d)},expandCollapse:function(b){var c,d=!1;if(b.attr("data-plugin")){var e=b.attr("data-plugin");c=a('[data-plugintarget="'+e+'"]');var f=c.children(),g=f.length,h=g;f.each(function(){h=a(this).hasClass("hide")?h-1:h,a(this).removeClass("hide")}),d=g!==h}if("undefined"!=typeof c&&(d||"true"!=c.attr("aria-expanded")?n(c,b):m(c,b)),b.attr("data-component")){var i=b.attr("data-component"),j=a('[data-section="'+i+'"]');"false"==j.attr("aria-expanded")?n(j,b):m(j,b)}},expandCollapseAll:function(b){var d="visible"==b,e="visible"==b?"hide":"visible";a(f.ELEMENTS).each(function(){a(this).addClass(b),a(this).removeClass(e),a(this).attr("aria-expanded",d)}),a(f.EXPANDALL).attr("data-visibility-state",e),c.get_string(b,"tool_dataprivacy").then(function(b){a(".tool_dataprivacy-expand-all").html(b)})["catch"](Notification.exception);var g="visible"==b?"fa-plus-square":"fa-minus-square",h="visible"==b?"fa-minus-square":"fa-plus-square",k="visible"==b?i.attr("src"):j.attr("src");a(f.AWESOMEICONS).each(function(){a(this).removeClass(g),a(this).addClass(h)}),a(f.OLDICONS).each(function(){a(this).attr("src",k)})},filterList:function(){var b={"api-issue":function(a){return!a.compliant},additional:function(a){return!!a.hasOwnProperty("external")}},c=function(a,c){var d=[];return e[a].plugins.forEach(function(a){b[c](a)&&d.push(a)}),d},i=a(f.ACTIVEFILTERS);i.length<h&&0==g&&(e=a.extend(!0,{},d)),h=i.length,i.each(function(){var b=a(this).attr("data-type"),d={};for(var f in e){var g=c(f,b);if(g.length>0){var h=e[f];h.plugins=g,d[f]=h}}e=d}),k()},followLink:function(b){var c=a('[data-id="'+b+'"]');c.removeClass("hide");var d=a('[data-section="'+b+'"]');d.removeClass("hide"),d.attr("aria-expanded",!0);var e=d.parents();e.removeClass("hide"),e.attr("aria-expanded",!0)},search:function(){var b=a(f.SEARCHBOX).val(),c=function(a){var c=[];return a.forEach(function(a){var d=a.component.toLowerCase();d.indexOf(b.toLowerCase())!==-1&&c.push(a)}),c};g>b.length&&(e=a.extend(!0,{},d)),g=b.length;for(var h in e){var i=c(e[h].plugins);e[h].plugins=i;var j=e[h].plugin_type.toLowerCase();j.indexOf(b.toLowerCase())==-1&&0==i.length&&delete e[h]}k()}}});