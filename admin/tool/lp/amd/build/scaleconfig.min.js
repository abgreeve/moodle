define(["jquery","core/notification","core/templates","core/str","core/ajax","core/dialogue"],function(a,b,c,d,e,f){var g=null,h=0,i=0,j=function(){i=a("#id_scale").val();var d=a("#id_scale option:selected").text();n(i).done(function(){var a={scalename:d,scales:g};c.render("tool_lp/scale_configuration_page",a).done(function(a){new f(d,a,l)}).fail(b.exception)}).fail(b.exception)},k=function(){var b=a("#tool_lp_scaleconfiguration").val();return""!==b?a.parseJSON(b):""},l=function(b){var c=a(b.getContent());if(h===i){var d=k();""!==d&&d.forEach(function(b){1===b.scaledefault&&a("#tool_lp_scale_default_"+b.id).attr("checked",!0),1===b.proficient&&a("#tool_lp_scale_proficient_"+b.id).attr("checked",!0)})}c.on("click",'[data-action="close"]',function(){m(),b.close()}),c.on("click",'[data-action="cancel"]',function(){b.close()})},m=function(){var b=[];g.forEach(function(c){var d=0,e=0;a("#tool_lp_scale_default_"+c.id).is(":checked")&&(d=1),a("#tool_lp_scale_proficient_"+c.id).is(":checked")&&(e=1),b.push({name:c.name,id:c.id,scaledefault:d,proficient:e})});var c=JSON.stringify(b);a("#tool_lp_scaleconfiguration").val(c),h=i},n=function(b){var c=a.Deferred(),d=e.call([{methodname:"tool_lp_get_scale_values",args:{scaleid:b}}]);return d[0].done(function(a){g=a,c.resolve(a)}).fail(function(a){c.reject(a)}),c.promise()};return{init:function(){h=a("#id_scale").val(),a("#id_scaleconfigbutton").click(j)}}});