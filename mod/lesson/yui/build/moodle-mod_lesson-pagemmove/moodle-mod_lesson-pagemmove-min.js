<<<<<<< HEAD
YUI.add("moodle-mod_lesson-pagemmove",function(e,t){function n(){n.superclass.constructor.apply(this,arguments)}var r={MAINCONTAINER:".mod_lesson_main",LESSONPAGES:".mod_lesson_pages",PAGEMODULES:".mod_lesson_page_element"},i=M.cfg.wwwroot+"/mod/lesson/ajax.php";e.namespace("M.mod_lesson").PagemMove=e.extend(n,e.Base,{initializer:function(){var t=e.all(r.PAGEMODULES),n=e.JSON.parse(this.get("lessondata"));YUI().use("dd-delegate","dd-drop-plugin",function(e){var t=new e.DD.Delegate({container:r.MAINCONTAINER,nodes:r.PAGEMODULES});t.on("drag:end",function(n){var r=t.get("currentNode");console.log(r.getXY());var s=i,o;o={method:"post",context:this,sync:!1,data:{action:"saveposition"},on:{success:function(t,n){var r,i;try{r=e.JSON.parse(n.responseText),console.log(r)}catch(s){}},failure:function(e,t){alert("something went wrong")}}},YUI().use("io-base",function(e){e.io(s,o)})})}),t.each(function(e){e.on("click",function(){console.log(e)})}),this._redraw()},_savedata:function(){console.log("saving data")},_redraw:function(){var t=e.JSON.parse(this.get("lessondata")),n=e.all(".mod_lesson_page_element")}},{NAME:"pagemMove",ATTRS:{lessondata:{value:null}}}),e.namespace("M.mod_lesson.PagemMove").init=function(e){return new n(e)}},"@VERSION@");
=======
YUI.add("moodle-mod_lesson-pagemmove",function(e,t){function n(){n.superclass.constructor.apply(this,arguments)}var r={MAINCONTAINER:".mod_lesson_main",LESSONPAGES:".mod_lesson_pages",PAGEMODULES:".mod_lesson_page_element"},i={PAGEWIDTH:300,PAGEHEIGHT:100,PATHFILL:{color:"#ff0000"},PAGEFILL:{color:"#ddddff"},PATHSTROKE:{weight:2,color:"#ff0000"},PAGESTROKE:{weight:2,color:"#000000"}};e.namespace("M.mod_lesson").PagemMove=e.extend(n,e.Base,{graphic:null,drawJump:function(e,t){var n=this.graphic.addShape({type:"path",stroke:i.PATHSTROKE,fill:i.PATHFILL});n.moveTo(e.x+e.width,e.y+e.height/2),n.lineTo(t.x,t.y+t.height/2),n.end(),e.jumpShapes[e.jumpShapes.length]=n},drawJumps:function(e,t){var n=0,r=0;console.log(e);var i="jumpto["+r+"]";while(e.hasOwnProperty(i)){nextpageid=e[i],nextpageid==="-1"&&(nextpageid=e.nextpageid);for(n=0;n<t.length;n++)t[n].id===nextpageid&&this.drawJump(e,t[n]);r+=1,i="jumpto["+r+"]"}},redrawPage:function(t){var n=e.one(r.LESSONPAGES),i;t.titleNode.setXY([t.x+n.getX()+10,t.y+n.getY()+10]),t.shapeNode.setXY([t.x+n.getX(),t.y+n.getY()]),i=t.jumpShapes.pop();while(typeof i!="undefined")this.graphic.removeShape(i),i=t.jumpShapes.pop();var s=this.get("pages");this.drawJumps(t,s)},redrawAllPages:function(){var e=this.get("pages"),t=0,n;for(t=0;t<e.length;t++)n=e[t],this.redrawPage(n)},drawPage:function(t,n){var s=e.one(r.LESSONPAGES);t.x=n.x,t.y=n.y,t.width=i.PAGEWIDTH,t.height=i.PAGEHEIGHT,t.jumpShapes=[];var o=this.graphic.addShape({type:e.Rect,width:t.width,height:t.height,x:n.x,y:n.y,fill:i.PAGEFILL,stroke:i.PAGESTROKE});t.shapeNode=o;var u=e.Node.create('<div style="cursor: pointer; width: 200px;">'+e.Escape.html(t.qtypestr)+": "+e.Escape.html(t.title)+"</div>");s.append(u),t.titleNode=u,u.setXY([n.x+s.getX()+10,n.y+s.getY()+10]);var a=(new e.DD.Drag({node:u})).plug(e.Plugin.DDConstrained,{constrain2node:r.MAINCONTAINER});a.on("drag:drag",function(e){t.x=e.pageX-s.getX()-10,t.y=e.pageY-s.getY()-10,this.redrawAllPages(),console.log(e),console.log(t)},this)},initializer:function(){this.graphic=new e.Graphic({render:r.LESSONPAGES});var t=this.get("pages"),n=0,i,s={x:0,y:0};for(n=0;n<t.length;n++)i=t[n],this.drawPage(i,s),s.y+=150;for(n=0;n<t.length;n++)i=t[n],this.drawJumps(i,t)}},{NAME:"pagemMove",ATTRS:{pages:{value:null}}}),e.namespace("M.mod_lesson.PagemMove").init=function(e){return new n({pages:e})}},"@VERSION@",{requires:["base","event","node","io","graphics","json","event-move","event-resize","dd-delegate","dd-plugin","dd-constrain","dd-drop-plugin"]});
>>>>>>> 9d397a4... Draw lines between pages and enable drag and drop
